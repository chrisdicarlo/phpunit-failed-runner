#!/bin/bash

logfile=./testdox.xml
if test -f "$logfile"; then
    echo "Logfile found. Filter for failed..."
    failed_tests="$(xmlstarlet tr --omit-decl ./vendor/chrisdicarlo/phpunit-failed-runner/failed-tests.xsl testdox.xml | sed s/\,/\|/g)"

    if [ "$failed_tests" = "" ]; then
	echo "No failed tests!  Great job!"
    else
        ./vendor/bin/phpunit --filter "'$failed_tests'"
    fi

else
   echo "Logfile not found. Running the full test suite..."
   ./phpunit
fi

exit 0
